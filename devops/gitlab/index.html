<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>沙滩星空的博客</title><meta name="description" content="金于沙里得，玉向石中求。个人博客主要是工作和学习的备忘笔记，包含开发与运维的提效脚本工具。">
    <link rel="preload" href="/assets/style-BFGakUI2.css" as="style"><link rel="stylesheet" href="/assets/style-BFGakUI2.css">
    <link rel="modulepreload" href="/assets/app-D3rUnszu.js"><link rel="modulepreload" href="/assets/index.html-DUlRNDX9.js">
    <link rel="prefetch" href="/assets/index.html-DKz9b3Ei.js" as="script"><link rel="prefetch" href="/assets/index.html-D5sxTzK9.js" as="script"><link rel="prefetch" href="/assets/index.html-B-mNBBMb.js" as="script"><link rel="prefetch" href="/assets/echarts-bar.html-CyEQeJnH.js" as="script"><link rel="prefetch" href="/assets/index.html-1qdwbQdb.js" as="script"><link rel="prefetch" href="/assets/gcc.html-D96Bjn4p.js" as="script"><link rel="prefetch" href="/assets/xxd.html-Dle07MPG.js" as="script"><link rel="prefetch" href="/assets/quick_run.html-DwYVYp8F.js" as="script"><link rel="prefetch" href="/assets/windows_remote_desktop.html-DpgKdJn-.js" as="script"><link rel="prefetch" href="/assets/index.html-qcgLelQm.js" as="script"><link rel="prefetch" href="/assets/buildexe.html-Bf6cA-U2.js" as="script"><link rel="prefetch" href="/assets/bytebase.html-CDkDnrwQ.js" as="script"><link rel="prefetch" href="/assets/logrotate.html-DYg7n5rq.js" as="script"><link rel="prefetch" href="/assets/redis.html-Bi2T56hk.js" as="script"><link rel="prefetch" href="/assets/setenv.html-DIfDXr23.js" as="script"><link rel="prefetch" href="/assets/sonarqube.html-DrlJS1yq.js" as="script"><link rel="prefetch" href="/assets/spug.html-Ds3XdtfQ.js" as="script"><link rel="prefetch" href="/assets/index.html-DSbu5qWN.js" as="script"><link rel="prefetch" href="/assets/datastruct.html-KVoTEm5T.js" as="script"><link rel="prefetch" href="/assets/index.html-CAcaSt7Q.js" as="script"><link rel="prefetch" href="/assets/proxy.html-pHSb9haw.js" as="script"><link rel="prefetch" href="/assets/registry.html-D83qYNSY.js" as="script"><link rel="prefetch" href="/assets/volumes.html-C7Gq0imc.js" as="script"><link rel="prefetch" href="/assets/index.html-Ic7Ztt-N.js" as="script"><link rel="prefetch" href="/assets/kettle.html-DS7ciwOa.js" as="script"><link rel="prefetch" href="/assets/kettle_conf.html-Ar9u_g33.js" as="script"><link rel="prefetch" href="/assets/kettle_issue.html-y0fBKRj3.js" as="script"><link rel="prefetch" href="/assets/kettle_select.html-e7htpltm.js" as="script"><link rel="prefetch" href="/assets/kettle_spoon.html-mF0dB-zJ.js" as="script"><link rel="prefetch" href="/assets/kettle_usage.html-VjQLUSSU.js" as="script"><link rel="prefetch" href="/assets/index.html-DRZ_ljCc.js" as="script"><link rel="prefetch" href="/assets/gitflow.html-smIkxoHG.js" as="script"><link rel="prefetch" href="/assets/gittag.html-CW_mIuFL.js" as="script"><link rel="prefetch" href="/assets/index.html-CrcKw4gu.js" as="script"><link rel="prefetch" href="/assets/cross_build.html-DN_FQC3G.js" as="script"><link rel="prefetch" href="/assets/dialog_file.html-BoxPrT-q.js" as="script"><link rel="prefetch" href="/assets/httpproxy_svr.html-1pKloBbb.js" as="script"><link rel="prefetch" href="/assets/index.html-B4dni4zZ.js" as="script"><link rel="prefetch" href="/assets/conf.html-CzffwkAa.js" as="script"><link rel="prefetch" href="/assets/envformvn.html-B2S6xiDd.js" as="script"><link rel="prefetch" href="/assets/jwt.html-DcS25b97.js" as="script"><link rel="prefetch" href="/assets/mvn.html-Ccr-Zqxe.js" as="script"><link rel="prefetch" href="/assets/nexus.html-DSu0n6mm.js" as="script"><link rel="prefetch" href="/assets/index.html-QTCMmHmj.js" as="script"><link rel="prefetch" href="/assets/disk.html-BqEP0V83.js" as="script"><link rel="prefetch" href="/assets/ssh.html-zrS7ygI4.js" as="script"><link rel="prefetch" href="/assets/index.html-PdCDBR4D.js" as="script"><link rel="prefetch" href="/assets/httpheader.html-COd9Fr9S.js" as="script"><link rel="prefetch" href="/assets/index.html-BX7R3dr7.js" as="script"><link rel="prefetch" href="/assets/location.html-XzUN8MvW.js" as="script"><link rel="prefetch" href="/assets/nginxui.html-CtTLiHgY.js" as="script"><link rel="prefetch" href="/assets/realip.html-B8oFP3xp.js" as="script"><link rel="prefetch" href="/assets/index.html-CuxegCyI.js" as="script"><link rel="prefetch" href="/assets/docs.html-DUD38YZl.js" as="script"><link rel="prefetch" href="/assets/n8n.html-CTFcRyr5.js" as="script"><link rel="prefetch" href="/assets/nvm.html-DwoJTvnr.js" as="script"><link rel="prefetch" href="/assets/jekyll.html-DUtKBfCN.js" as="script"><link rel="prefetch" href="/assets/add_index.html-CSBjlGkK.js" as="script"><link rel="prefetch" href="/assets/index.html-C58Jn_p-.js" as="script"><link rel="prefetch" href="/assets/role.html-CRt5OcgB.js" as="script"><link rel="prefetch" href="/assets/issue.html-P4asiLV1.js" as="script"><link rel="prefetch" href="/assets/runner.html-DOIqZUdx.js" as="script"><link rel="prefetch" href="/assets/index.html-BDp_D-AC.js" as="script"><link rel="prefetch" href="/assets/dashboards.html-D4aMAqRU.js" as="script"><link rel="prefetch" href="/assets/loki_nginx.html-CrNEMPI6.js" as="script"><link rel="prefetch" href="/assets/node_exporter.html-CRpltNIz.js" as="script"><link rel="prefetch" href="/assets/prometheus.html-B3jdoAPc.js" as="script"><link rel="prefetch" href="/assets/index.html-D4J87MbI.js" as="script"><link rel="prefetch" href="/assets/config.html-DXwR3QQF.js" as="script"><link rel="prefetch" href="/assets/errors.html-CEvIGsSj.js" as="script"><link rel="prefetch" href="/assets/flowable.html-D3Ts-bhq.js" as="script"><link rel="prefetch" href="/assets/inoutputs.html-tSeeaukD.js" as="script"><link rel="prefetch" href="/assets/namespace.html-CdNmt2DK.js" as="script"><link rel="prefetch" href="/assets/scripts.html-6FpJ4GUo.js" as="script"><link rel="prefetch" href="/assets/triggers.html-BJLn9LVv.js" as="script"><link rel="prefetch" href="/assets/start_docker.html-DH-WUo6q.js" as="script"><link rel="prefetch" href="/assets/taiga.html-C2DRTB1n.js" as="script"><link rel="prefetch" href="/assets/index.html-CoN9_wcl.js" as="script"><link rel="prefetch" href="/assets/index.html-CCA6v9As.js" as="script"><link rel="prefetch" href="/assets/index.html-Dv2ZFfSk.js" as="script"><link rel="prefetch" href="/assets/if.html-B_JRX2xF.js" as="script"><link rel="prefetch" href="/assets/index.html-CzLhkv3B.js" as="script"><link rel="prefetch" href="/assets/journald.html-BPhQD_Sb.js" as="script"><link rel="prefetch" href="/assets/jwt.html-DBu0c90v.js" as="script"><link rel="prefetch" href="/assets/view_data.html-iN0eG0Sk.js" as="script"><link rel="prefetch" href="/assets/index.html-CrUU9DSR.js" as="script"><link rel="prefetch" href="/assets/404.html-DoM5Aq0E.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">沙滩星空的博客</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h2 id="gitlab简介" tabindex="-1"><a class="header-anchor" href="#gitlab简介"><span>GitLab简介</span></a></h2><p>‌GitLab是一个基于Git的开源项目，旨在帮助团队更高效地合作和开发软件。‌它使用Ruby on Rails框架构建，提供了一个自托管的Git仓库管理工具，支持版本控制、代码审查、持续集成和持续部署等功能。‌</p><p>主要功能包括：</p><p>-‌ 版本控制‌：用户可以创建分支、合并代码，并处理冲突，确保代码的历史和变更管理得当。 ‌- 代码审查‌：团队成员可以通过拉取请求（Pull Requests）对提交的代码进行评论和讨论，确保代码质量。 ‌- 持续集成/持续部署（CI/CD）‌：GitLab内置了CI/CD功能，支持自动化的构建、测试和部署流程，提高开发效率。 ‌- 项目管理‌：通过Issue跟踪、看板、里程碑等功能，帮助团队管理项目进度和任务。</p><p>GitLab还提供了权限管理和审计日志，确保代码的安全性和合规性，适用于从小型开源项目到大型企业级应用的各种规模团队。 GitLab是实现 <code>DevOPS</code> 自动化开发运维流水线的经典工具。</p><h2 id="硬件需求" tabindex="-1"><a class="header-anchor" href="#硬件需求"><span>硬件需求</span></a></h2><table><thead><tr><th>硬件</th><th>需求</th><th>说明</th></tr></thead><tbody><tr><td>硬盘</td><td>安装空间2.5G，转速 &gt; 7200RPM</td><td>实际存储空间取决于代码仓库所占大小</td></tr><tr><td>CPU</td><td>8核</td><td>每秒最多 20 个请求或 1000 个用户</td></tr><tr><td>内存</td><td>至少8G，推荐16G</td><td>16G满足每秒最多 20 个请求或 1000 个用户</td></tr></tbody></table><h2 id="设置gitlab-home路径" tabindex="-1"><a class="header-anchor" href="#设置gitlab-home路径"><span>设置GITLAB_HOME路径</span></a></h2><p>先设置一个 <code>GITLAB_HOME</code> 环境变量，为gitlab的工作目录。有2个方式：</p><ol><li><p>写入环境变量配置文件（推荐）。在 <code>docker-compose.yml</code> 文件的同级目录创建 <code>.env</code> 文件。写入 <code>GITLAB_HOME=/srv/gitlab</code></p></li><li><p>添加到shell的启动配置文件中。<code>echo &quot;GITLAB_HOME=/srv/gitlab&quot; &gt;&gt; ~/.bash_profile</code></p></li></ol><p>通过第2种方式添加配置后，使用 <code>source ~/.bash_profile</code> 命令，使配置生效</p><h2 id="创建docker挂载目录" tabindex="-1"><a class="header-anchor" href="#创建docker挂载目录"><span>创建docker挂载目录</span></a></h2><p>进入上一步骤设置的 <code>$GITLAB_HOME</code> 目录中，新建 <code>data</code>, <code>logs</code>, <code>config</code> 个文件夹。</p><p>如下所示：</p><table><thead><tr><th>宿主机目录</th><th>容器内部目录</th><th>说明</th></tr></thead><tbody><tr><td>$GITLAB_HOME/data</td><td>/var/opt/gitlab</td><td>Stores application data.</td></tr><tr><td>$GITLAB_HOME/logs</td><td>/var/log/gitlab</td><td>Stores logs.</td></tr><tr><td>$GITLAB_HOME/config</td><td>/etc/gitlab</td><td>Stores the GitLab configuration files.</td></tr></tbody></table><h2 id="获取可用的gitlab版本" tabindex="-1"><a class="header-anchor" href="#获取可用的gitlab版本"><span>获取可用的GitLab版本</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 镜像名格式：</span>
<span class="line">gitlab/gitlab-ce:&lt;version&gt;-ce.0</span>
<span class="line"></span>
<span class="line"># 指定固定版本镜像</span>
<span class="line">gitlab/gitlab-ce:17.6.2-ce.0</span>
<span class="line"></span>
<span class="line"># 使用最新版本镜像</span>
<span class="line">gitlab/gitlab-ce:latest</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编写docker-compose-yml文件" tabindex="-1"><a class="header-anchor" href="#编写docker-compose-yml文件"><span>编写docker-compose.yml文件</span></a></h2><p><code>docker-compose.yml</code>:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">version: &#39;3.6&#39;</span>
<span class="line">services:</span>
<span class="line">  gitlab:</span>
<span class="line">    image: gitlab/gitlab-ce:17.6.2-ce.0</span>
<span class="line">    container_name: gitlab</span>
<span class="line">    restart: always</span>
<span class="line">    hostname: &#39;gitlab.example.com&#39;</span>
<span class="line">    environment:</span>
<span class="line">      GITLAB_OMNIBUS_CONFIG: |</span>
<span class="line">        external_url &#39;http://gitlab.example.com:8929&#39;</span>
<span class="line">        gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2424</span>
<span class="line">    ports:</span>
<span class="line">      - &#39;8929:8929&#39;</span>
<span class="line">      - &#39;443:443&#39;</span>
<span class="line">      - &#39;2424:22&#39;</span>
<span class="line">    volumes:</span>
<span class="line">      - &#39;$GITLAB_HOME/config:/etc/gitlab&#39;</span>
<span class="line">      - &#39;$GITLAB_HOME/logs:/var/log/gitlab&#39;</span>
<span class="line">      - &#39;$GITLAB_HOME/data:/var/opt/gitlab&#39;</span>
<span class="line">    shm_size: &#39;256m&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 <code>GITLAB_OMNIBUS_CONFIG</code> 环境变量，配置 <code>external_url</code> 参数，设定仓库的HTTP地址。</p><p><code>ports</code> 的端口映射，以 <code>GITLAB_OMNIBUS_CONFIG</code> 的相关配置项为准。</p><h2 id="启动docker" tabindex="-1"><a class="header-anchor" href="#启动docker"><span>启动docker</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker compose up -d</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>容器首次启动，需要数分钟的时间，请耐心等待。 启动成功后，容器状态由 <code>(health: starting)</code> 变为 <code>(healthy)</code>。如下所示：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">NAME      IMAGE                          COMMAND             SERVICE   CREATED       STATUS                             PORTS</span>
<span class="line">gitlab    gitlab/gitlab-ce:17.6.2-ce.0   &quot;/assets/wrapper&quot;   gitlab    2 hours ago   Up 12 seconds (health: starting)   0.0.0.0:443-&gt;443/tcp, :::443-&gt;443/tcp, 80/tcp, 0.0.0.0:8929-&gt;8929/tcp, :::8929-&gt;8929/tcp, 0.0.0.0:2424-&gt;22/tcp, [::]:2424-&gt;22/tcp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">NAME      IMAGE                          COMMAND             SERVICE   CREATED       STATUS                    PORTS</span>
<span class="line">gitlab    gitlab/gitlab-ce:17.6.2-ce.0   &quot;/assets/wrapper&quot;   gitlab    3 hours ago   Up 51 minutes (healthy)   0.0.0.0:443-&gt;443/tcp, :::443-&gt;443/tcp, 80/tcp, 0.0.0.0:8929-&gt;8929/tcp, :::8929-&gt;8929/tcp, 0.0.0.0:2424-&gt;22/tcp, [::]:2424-&gt;22/tcp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看容器运行日志：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo docker logs -f gitlab</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过前面配置的 <code>external_url</code>，访问 GitLab 项目地址，登录root账号。</p><ul><li>用户名为： <code>root</code></li><li>用户密码查看文件：宿主机的 <code>$GITLAB_HOME/config/initial_root_password</code> 或容器内的 <code>/etc/gitlab/initial_root_password</code></li></ul><p>注：The password file is automatically deleted in the first container restart after 24 hours.</p><h2 id="基础配置" tabindex="-1"><a class="header-anchor" href="#基础配置"><span>基础配置</span></a></h2><h3 id="gitlab-omnibus-config" tabindex="-1"><a class="header-anchor" href="#gitlab-omnibus-config"><span>GITLAB_OMNIBUS_CONFIG</span></a></h3><p><code>GITLAB_OMNIBUS_CONFIG</code> 环境变量，允许预设 <code>gitlab.rb</code> 文件的配置项。 具有以下特点：</p><ul><li>比容器内的 <code>gitlab.rb</code> 配置文件更先被读取。</li><li>只会在系统启动时被加载，而不会直接修改 <code>gitlab.rb</code> 文件。</li><li>允许设置多个配置项，使用 <code>;</code> 符号隔开。</li></ul><p>配置可包含 GitLab项目地址，数据库配置等。具体请见: <a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-config-template/gitlab.rb.template" target="_blank" rel="noopener noreferrer">gitlab.rb文件配置模板</a></p><ul><li><code>external_url</code>：项目主页。如：<code>&quot;http://gitlab.example.com:8929&quot;</code></li><li><code>gitlab_rails[&#39;gitlab_shell_ssh_port&#39;]</code>：SSH端口。如：<code>2424</code></li><li><code>gitlab_rails[&#39;initial_root_password&#39;]</code>: 项目初始化时，预设的root用户密码。</li></ul><p>项目首次启动时，也可在容器内注入环境变量 <code>GITLAB_ROOT_PASSWORD</code> ，预设 root 用户的登录密码。</p><p>Docker运行命令如下所示：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo docker run --detach \</span>
<span class="line">  --hostname gitlab.example.com \</span>
<span class="line">  --env GITLAB_OMNIBUS_CONFIG=&quot;external_url &#39;http://gitlab.example.com:8929&#39;; gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2424&quot; \</span>
<span class="line">  --publish 8929:8929 --publish 2424:22 \</span>
<span class="line">  --name gitlab \</span>
<span class="line">  --restart always \</span>
<span class="line">  --volume $GITLAB_HOME/config:/etc/gitlab \</span>
<span class="line">  --volume $GITLAB_HOME/logs:/var/log/gitlab \</span>
<span class="line">  --volume $GITLAB_HOME/data:/var/opt/gitlab \</span>
<span class="line">  --shm-size 256m \</span>
<span class="line">  gitlab/gitlab-ce:&lt;version&gt;-ce.0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改配置" tabindex="-1"><a class="header-anchor" href="#修改配置"><span>修改配置</span></a></h3><ol><li>进入容器：<code>sudo docker exec -it gitlab /bin/bash</code></li><li>修改配置文件：<code>editor /etc/gitlab/gitlab.rb</code></li><li>重载配置：<code>gitlab-ctl reconfigure</code></li></ol><h2 id="中文设置" tabindex="-1"><a class="header-anchor" href="#中文设置"><span>中文设置</span></a></h2><ol><li><p>全局设置：左下角菜单 <code>Admin</code>，点击：<code>Settings</code> - <code>Preferences</code>。 页面找到 <code>Localization</code> - <code>Default language</code></p></li><li><p>用户个性化设置：点击左上角用户头像，下拉框选择 <code>Preferences</code>。页面找到 <code>Localization</code> - <code>Language</code></p></li></ol><p>当前用户，一定是更改 <code>用户个性化设置</code>，才能生效：</p><p>在页面右上方的用户菜单中，选择“Settings”。 进入Settings页面后，点击左侧导航栏中的“Preferences”选项。 在Preferences页面中，找到“Localization”区域，将“Language”选项修改为“简体中文”。 点击页面下方的“Save changes”按钮，保存语言设置。</p><h2 id="推荐设置" tabindex="-1"><a class="header-anchor" href="#推荐设置"><span>推荐设置</span></a></h2><p>GitLab的设置界面，从左下角的设置菜单进入。其设置机制，从上往下分三个层级：<code>管理员</code> -&gt; <code>群组</code> -&gt; <code>项目</code>。 上层级的设置，为下一层级的默认值。下一层修改设置，会覆盖上一层。</p><ol><li>点击左下角 <code>管理员</code> - <code>设置</code> - <code>CI/CD</code> - <code>持续集成和部署</code>：取消 <code>所有项目默认使用Auto DevOps流水线</code>, <code>为新项目启用实例 Runner</code> 这两个默认勾选。设置地址：<code>/admin/application_settings/ci_cd</code></li></ol><h2 id="数据库配置" tabindex="-1"><a class="header-anchor" href="#数据库配置"><span>数据库配置</span></a></h2><p>自 <code>GitLab 16.0</code> 起，GitLab默认使用2个数据库连接。我们可以禁用，回到原始的单连接模式。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo docker exec -it gitlab editor /etc/gitlab/gitlab.rb</span>
<span class="line">gitlab_rails[&#39;databases&#39;][&#39;ci&#39;][&#39;enable&#39;] = false</span>
<span class="line">sudo docker restart gitlab</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="日志配置" tabindex="-1"><a class="header-anchor" href="#日志配置"><span>日志配置</span></a></h2><p>GitLab Omnibus 包已经内置了强大的 logrotate 配置。主要修改 <code>/etc/gitlab/gitlab.rb</code> 文件。</p><p>Logrotate 核心配置：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 启用并配置 logrotate</span>
<span class="line">logging[&#39;logrotate_enabled&#39;] = true</span>
<span class="line"></span>
<span class="line"># 设置轮转周期：&#39;daily&#39; (默认), &#39;weekly&#39;, &#39;monthly&#39;</span>
<span class="line">logging[&#39;logrotate_frequency&#39;] = &quot;daily&quot;</span>
<span class="line"></span>
<span class="line"># 保留多少个轮转后的归档日志文件 (默认 30 个)</span>
<span class="line">logging[&#39;logrotate_rotate&#39;] = 7  # 强烈建议减少，例如保留 7 天。这是控制磁盘占用的关键！</span>
<span class="line"></span>
<span class="line"># 轮转前旧日志的最大大小（可选，但建议设置）。例如 100MB。达到此大小即使没到轮转时间也触发轮转。</span>
<span class="line">logging[&#39;logrotate_size&#39;] = &quot;100M&quot;</span>
<span class="line"></span>
<span class="line"># 轮转后立即压缩旧日志 (默认 true)</span>
<span class="line">logging[&#39;logrotate_compress&#39;] = true</span>
<span class="line"></span>
<span class="line"># 使用日期作为轮转文件的后缀 (如 production.log-20230703.gz) (默认 true)</span>
<span class="line">logging[&#39;logrotate_dateformat&#39;] = true</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使配置立即生效</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo gitlab-ctl reconfigure  # 应用 gitlab.rb 中的配置更改，会重新生成 logrotate 规则</span>
<span class="line">sudo gitlab-ctl restart      # 重启所有 GitLab 组件 (有时 reconfigure 后重启更保险)</span>
<span class="line"># 强制 logrotate 立即执行一次轮转（即使未达到 size/time 条件）</span>
<span class="line">sudo /opt/gitlab/embedded/sbin/logrotate -fv /var/opt/gitlab/logrotate/logrotate.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="系统邮箱配置" tabindex="-1"><a class="header-anchor" href="#系统邮箱配置"><span>系统邮箱配置</span></a></h2><ol><li>修改配置文件：<code>/etc/gitlab/gitlab.rb</code></li><li>重载配置，使其生效：<code>gitlab-ctl reconfigure</code></li><li><code>smtp_user_name</code> 和 <code>gitlab_email_from</code> 要填同一个邮箱，并且 <code>smtp_password</code> 这个密码必须和邮箱对得上。没有账号要让邮箱管理员开账号。</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">gitlab_rails[&#39;smtp_enable&#39;] = true</span>
<span class="line">gitlab_rails[&#39;smtp_address&#39;] = &quot;smtp.server&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_port&#39;] = 465</span>
<span class="line">gitlab_rails[&#39;smtp_user_name&#39;] = &quot;smtp user&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_password&#39;] = &quot;smtp password&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_domain&#39;] = &quot;example.com&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_authentication&#39;] = &quot;login&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = true</span>
<span class="line">gitlab_rails[&#39;smtp_openssl_verify_mode&#39;] = &#39;peer&#39;</span>
<span class="line"></span>
<span class="line"># If your SMTP server does not like the default &#39;From: gitlab@localhost&#39; you</span>
<span class="line"># can change the &#39;From&#39; with this setting.</span>
<span class="line">gitlab_rails[&#39;gitlab_email_from&#39;] = &#39;gitlab@example.com&#39;</span>
<span class="line">gitlab_rails[&#39;gitlab_email_reply_to&#39;] = &#39;noreply@example.com&#39;</span>
<span class="line"></span>
<span class="line"># If your SMTP server is using a self signed certificate or a certificate which</span>
<span class="line"># is signed by a CA which is not trusted by default, you can specify a custom ca file.</span>
<span class="line"># Please note that the certificates from /etc/gitlab/trusted-certs/ are</span>
<span class="line"># not used for the verification of the SMTP server certificate.</span>
<span class="line">gitlab_rails[&#39;smtp_ca_file&#39;] = &#39;/path/to/your/cacert.pem&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：QQ exmail (腾讯企业邮箱)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">gitlab_rails[&#39;smtp_enable&#39;] = true</span>
<span class="line">gitlab_rails[&#39;smtp_address&#39;] = &quot;smtp.exmail.qq.com&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_port&#39;] = 465</span>
<span class="line">gitlab_rails[&#39;smtp_user_name&#39;] = &quot;xxxx@xx.com&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_password&#39;] = &quot;password&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_authentication&#39;] = &quot;login&quot;</span>
<span class="line">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] = false</span>
<span class="line">gitlab_rails[&#39;smtp_tls&#39;] = true</span>
<span class="line">gitlab_rails[&#39;gitlab_email_from&#39;] = &#39;xxxx@xx.com&#39;</span>
<span class="line">gitlab_rails[&#39;smtp_domain&#39;] = &quot;exmail.qq.com&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><blockquote><p>GitLab installation requirements https://docs.gitlab.com/install/requirements/ Install GitLab in a Docker container https://docs.gitlab.com/install/docker/installation/ Steps after installing GitLab: https://docs.gitlab.com/install/next_steps/</p></blockquote></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最近更新: </span><time class="meta-item-info" datetime="2025-07-03T10:57:10.000Z" data-allow-mismatch>2025/7/3 10:57</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: whq78164@gmail.com">Hankin</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-D3rUnszu.js" defer></script>
  </body>
</html>
