import{_ as s,c as n,e as a,o as i}from"./app-B0UrfQJy.js";const t={};function l(r,e){return i(),n("div",null,[...e[0]||(e[0]=[a(`<h2 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题</span></a></h2><p>国内互联网环境状况堪忧。最近连国内各大docker镜像源都用不了。拉取Docker镜像一直失败。尝试用HTTP代理也经常报错。发现还是socks5代理好用。</p><h2 id="代理设置" tabindex="-1"><a class="header-anchor" href="#代理设置"><span>代理设置</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir -p /etc/systemd/system/docker.service.d</span>
<span class="line">vim /etc/systemd/system/docker.service.d/http-proxy.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>往 <code>/etc/systemd/system/docker.service.d/http-proxy.conf</code> 文件添加内容：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">[Service]</span>
<span class="line">Environment=&quot;HTTP_PROXY=socks5://user:pass@127.0.0.1:1080&quot;</span>
<span class="line">Environment=&quot;HTTPS_PROXY=socks5://user:pass@127.0.0.1:1080&quot;</span>
<span class="line"># 如果要访问本地私有网络，可以设置 NO_PROXY 环境变量。或禁用代理。</span>
<span class="line">Environment=&quot;NO_PROXY=localhost,127.0.0.1&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启docker</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl daemon-reload</span>
<span class="line">systemctl restart docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看环境变量:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">sudo systemctl show --property=Environment docker</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="群晖nas" tabindex="-1"><a class="header-anchor" href="#群晖nas"><span>群晖NAS</span></a></h3><p>群晖 <code>Container Manager</code> 配置代理</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">mkdir -p /etc/systemd/system/pkg-ContainerManager-dockerd.service.d</span>
<span class="line">vi /etc/systemd/system/pkg-ContainerManager-dockerd.service.d/http-proxy.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">[Service]</span>
<span class="line">Environment=&quot;HTTP_PROXY=socks5://192.168.1.3:10808&quot;</span>
<span class="line">Environment=&quot;HTTPS_PROXY=socks5://192.168.1.3:10808&quot;</span>
<span class="line">Environment=&quot;NO_PROXY=localhost,127.0.0.1&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl daemon-reload</span>
<span class="line">systemctl restart pkg-ContainerManager-dockerd.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl show --property=Environment pkg-ContainerManager-dockerd.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>另外如果要在 Docker 容器内通过代理访问网络，你可以在运行 Docker 容器时，设置环境变量来指定代理，例如：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">docker run -e http_proxy=http://your-proxy:port \\</span>
<span class="line">           -e https_proxy=http://your-proxy:port \\</span>
<span class="line">           -e no_proxy=localhost,127.0.0.1 \\</span>
<span class="line">           your-image</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><blockquote><p>Docker Hub 镜像加速 https://gitee.com/wanfeng789/docker-hub Synology 群辉NAS安装（5）介绍一下NAS的体系和安装container manager https://blog.csdn.net/haoyujie/article/details/145368583</p></blockquote>`,20)])])}const c=s(t,[["render",l]]),o=JSON.parse('{"path":"/docker/proxy.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1760193362000,"contributors":[{"name":"Hankin","username":"Hankin","email":"hankin@catmes.com","commits":2,"url":"https://github.com/Hankin"}],"changelog":[{"hash":"17d0a18cb1e7c76ad94b69f523872c9d6e37a375","time":1760193362000,"email":"hankin@catmes.com","author":"Hankin","message":"UPDATE Nexus"},{"hash":"9050ff3d6218227a004a1d381d9dcb0fd7980e71","time":1748797129000,"email":"hankin@catmes.com","author":"Hankin","message":"UPDATE nodejs: nvm, n8n. docker: proxy registry volumes"}]},"filePathRelative":"docker/proxy.md"}');export{c as comp,o as data};
