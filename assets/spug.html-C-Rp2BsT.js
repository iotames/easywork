import{_ as n,c as a,e,o as p}from"./app-CRkzPy7i.js";const l={};function i(t,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="安装spug运维平台" tabindex="-1"><a class="header-anchor" href="#安装spug运维平台"><span>安装Spug运维平台</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>docker-compose.yml文件：</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment"># version: &quot;3.3&quot;</span></span>
<span class="line"><span class="token key atrule">services</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/openspug/mariadb<span class="token punctuation">:</span>10.8.2</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> spug<span class="token punctuation">-</span>db</span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>port 3306 <span class="token punctuation">-</span><span class="token punctuation">-</span>character<span class="token punctuation">-</span>set<span class="token punctuation">-</span>server=utf8mb4 <span class="token punctuation">-</span><span class="token punctuation">-</span>collation<span class="token punctuation">-</span>server=utf8mb4_unicode_ci</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./data/spug/mysql<span class="token punctuation">:</span>/var/lib/mysql</span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=spug</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_USER=spug</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PASSWORD=spug.cc</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=spug.cc</span>
<span class="line">  <span class="token key atrule">spug</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">image</span><span class="token punctuation">:</span> registry.cn<span class="token punctuation">-</span>hangzhou.aliyuncs.com/openspug/spug<span class="token punctuation">-</span>service</span>
<span class="line">    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> spug</span>
<span class="line">    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></span>
<span class="line">    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</span>
<span class="line">    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> ./data/spug/service<span class="token punctuation">:</span>/data/spug</span>
<span class="line">      <span class="token punctuation">-</span> ./data/spug/repos<span class="token punctuation">:</span>/data/repos</span>
<span class="line">    <span class="token key atrule">ports</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token comment"># 如果80端口被占用可替换为其他端口，例如: - &quot;8000:80&quot;</span></span>
<span class="line">      <span class="token punctuation">-</span> <span class="token string">&quot;88:80&quot;</span></span>
<span class="line">    <span class="token key atrule">environment</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_DATABASE=spug</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_USER=spug</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PASSWORD=spug.cc</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_HOST=db</span>
<span class="line">      <span class="token punctuation">-</span> MYSQL_PORT=3306</span>
<span class="line">    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> db</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="初始化账号密码" tabindex="-1"><a class="header-anchor" href="#初始化账号密码"><span>初始化账号密码</span></a></h2><p>以下操作会创建一个用户名为 admin 密码为 spug.cc 的管理员账户，可自行替换管理员账户/密码。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">docker</span> <span class="token builtin class-name">exec</span> spug init_spug admin spug.cc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="配置批量执行命令模板" tabindex="-1"><a class="header-anchor" href="#配置批量执行命令模板"><span>配置批量执行命令模板</span></a></h2><ol><li>批量执行 - 模板管理 - 新建 - 脚本语言选择<code>Shell</code></li><li>点击 <code>参数化</code> 旁边的 <code>添加参数</code>，添加参数两个参数。</li></ol><ul><li><p>参数名：<code>用户名</code>。变量名：<code>username</code>。参数类型：<code>文本框</code>。必填：<code>否</code>。默认值：<code>:</code>。提示信息：<code>输入冒号:表示查询所有用户，留空不查询</code></p></li><li><p>参数名：<code>用户组</code>。变量名：<code>usergroup</code>。参数类型：<code>文本框</code>。必填：<code>否</code>。默认值：<code>:</code>。提示信息：<code>输入冒号:表示查询所有用户组，留空不查询</code></p></li></ul><ol start="3"><li><code>模板内容</code> 如下所示：</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$_SPUG_username</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">  <span class="token builtin class-name">echo</span> <span class="token string">&quot;用户列表：&quot;</span></span>
<span class="line">  <span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable">$_SPUG_username</span>&quot;</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">  <span class="token builtin class-name">echo</span> <span class="token string">&quot;跳过用户查询&quot;</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$_SPUG_usergroup</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">  <span class="token builtin class-name">echo</span> <span class="token string">&quot;用户组列表：&quot;</span></span>
<span class="line">  <span class="token function">cat</span> /etc/group <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable">$_SPUG_usergroup</span>&quot;</span></span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">  <span class="token builtin class-name">echo</span> <span class="token string">&quot;跳过用户组查询&quot;</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="其他命令模板" tabindex="-1"><a class="header-anchor" href="#其他命令模板"><span>其他命令模板</span></a></h3><p>代码更新:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">pwd</span></span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token variable">$_SPUG_path</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;the path is:<span class="token variable">$_SPUG_path</span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">pwd</span></span>
<span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> status</span>
<span class="line"><span class="token function">git</span> log --max-count<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码回滚:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function-name function">get_latest_commits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token assign-left variable">n</span><span class="token operator">=</span><span class="token variable">\${1<span class="token operator">:-</span>1}</span></span>
<span class="line">    <span class="token comment"># 验证参数是否为正整数</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable">$n</span>&quot;</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-Eq</span> <span class="token string">&#39;^[0-9]+$&#39;</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$n</span>&quot;</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">        <span class="token builtin class-name">echo</span> <span class="token string">&quot;错误：参数必须是正整数&quot;</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span></span>
<span class="line">        <span class="token builtin class-name">return</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 获取最近n条提交的commitID</span></span>
<span class="line">    <span class="token function">git</span> log <span class="token parameter variable">--pretty</span><span class="token operator">=</span>format:%H <span class="token parameter variable">-n</span> <span class="token string">&quot;<span class="token variable">$n</span>&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">line</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$n</span>&quot;</span> <span class="token string">&#39;NR==line&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token builtin class-name">pwd</span></span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token variable">$_SPUG_gpath</span></span>
<span class="line"><span class="token builtin class-name">pwd</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$_SPUG_commit_index</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;0&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;拉取最新代码：git pull&quot;</span></span>
<span class="line">    <span class="token function">git</span> pull</span>
<span class="line"><span class="token keyword">else</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;重置至第<span class="token variable">$_SPUG_commit_index</span>条提交&quot;</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;重置前：&quot;</span></span>
<span class="line">    <span class="token function">git</span> log --max-count<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line">    <span class="token assign-left variable">commitID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>get_latest_commits $_SPUG_commit_index<span class="token variable">)</span></span></span>
<span class="line">    <span class="token function">git</span> reset <span class="token parameter variable">--hard</span> <span class="token variable">$commitID</span></span>
<span class="line">    <span class="token builtin class-name">echo</span> <span class="token string">&quot;重置后：&quot;</span></span>
<span class="line">    <span class="token function">git</span> log --max-count<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,17)])])}const o=n(l,[["render",i]]),u=JSON.parse('{"path":"/devops/spug.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"updatedTime":1756395098000,"contributors":[{"name":"Hankin","username":"Hankin","email":"554553400@qq.com","commits":3,"url":"https://github.com/Hankin"}],"changelog":[{"hash":"bd430b4ceef81e5d517ef247e0e099d0fe8875d2","time":1756395098000,"email":"hankin@catmes.com","author":"Hankin","message":"UPDATE spug, git"},{"hash":"af65f6c7c78d742c0b691e79aae1f1b950762bd1","time":1756376483000,"email":"554553400@qq.com","author":"Hankin","message":"UPDATE spug"},{"hash":"dc2cad6597483dfed56b5d04ef7243e1a6d3149b","time":1756368042000,"email":"554553400@qq.com","author":"Hankin","message":"ADD spug for devops"}]},"filePathRelative":"devops/spug.md"}');export{o as comp,u as data};
